language: cpp
matrix:
  include:
    - os: linux
      sudo: enabled
      dist: precise
    - os: osx

install: "./install-dependencies.sh"
script: "./build.sh"
git:
  depth: 1
  submodules: false
before_deploy:
- git config --local user.email "builds@travis-ci.com"
- git config --local user.name "Travis CI"
- export GIT_TAG=$TRAVIS_BRANCH-0.1.$TRAVIS_BUILD_NUMBER
#- git tag $GIT_TAG -a -m "Generated tag from TravisCI for build $TRAVIS_BUILD_NUMBER"
#- git fetch --tags
- git tag "latest-$TRAVIS_OS_NAME" -fa -m "Generated tag from TravisCI for build $TRAVIS_BUILD_NUMBER"
- git push -q -f https://$GH_TOKEN@github.com/ice0/mpm --tags
#- git config --local user.name "ice0"
#- git config --local user.email "konoplin@gmail.com"
#- git tag -f "latest"
deploy:
  provider: releases
  skip_cleanup: true
  overwrite: true
  prerelease: true
  latest: true
  name: "latest-$TRAVIS_OS_NAME"
  api_key: $GH_TOKEN
  file: build-$TRAVIS_OS_NAME.tgz
  on:
    repo: ice0/mpm
